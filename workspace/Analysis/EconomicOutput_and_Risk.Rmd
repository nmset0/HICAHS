---
title: "Economic Output and Risk Factors"
author: "Nathan Seto"
output: pdf_document
---

```{r, include = FALSE}
library(knitr)
library(tidyr)
library(tidyverse)
library(readr)
library(ggcorrplot)
library(dplyr)
opts_chunk$set(echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE, tidy = TRUE)
```

## What is the relationship between health risk concentrations and economic output?

#### Calculate correlations between environmental exposures and farm sales (and/or other econ. variables) to understand economic linkages.

A p-value of 0 reflects that it is statistically impossible to reach these results under a true null hypothesis.

```{r, include = FALSE}
output_risk_combined <- read_csv("~/internship/workspace/Analysis/output_risk_combined.csv")
source("C:/Users/natha/OneDrive/Documents/internship/workspace/Analysis/outputriskfunction.R")
process_risk_data(output_risk_combined, "crop_totals_sales_measured_in_$")
correlation_df <- correlation_df[-1,]
correlation_df$p_value <- round(correlation_df$p_value, digits = 4)
split_dfs <- split(correlation_df, correlation_df$category)
list2env(split(correlation_df, correlation_df$category), envir = .GlobalEnv)
```

#### Correlation Coefficients between predictor $X$ and `Crop Total Sales ($)`

```{r}
tibble(income[,-4]) |> arrange(predictor)
```

```{r}
tibble(salesQuantity[,-4]) |> arrange(desc(predictor))
```

```{r}
tibble(crops[,-4]) |> arrange(predictor)
```

```{r}
tibble(animals[,-4]) |> arrange(predictor)
```

```{r}
tibble(agriculturalLand[,-4])
```

```{r}
area_operated <- area_operated[c(6, 7, 4, 2, 1, 3, 8, 5),]
tibble(area_operated[,-4])
```

```{r}
tibble(nature[,-4]) |> arrange(predictor)
```

```{r}
tibble(costs[,-4])
```

```{r}
tibble(expectedLoss[,-4])
```

```{r}
tibble(operations[,-4])
```

```{r}
tibble(riskIndex[,-4])
```

```{r}
tibble(social[,-4]) |> arrange(predictor) 
```

```{r}
tibble(other[,-4])
```

```{r}
cat("Count of Significant (True) and Non-Significant (False) Correlations (p < 0.05) \n")
table(correlation_df$significance)

tibble(correlation_df[correlation_df$significance==TRUE, c(1,3)])
```
Below are a series of correlation plots between variables of economic output and different weather and natural disaster predictors.
$\\$

```{r}
output_environmentalRisk <- output_risk_combined  |>
  select(matches("farm_sales_|drought|wildfire|Cold\\.Wave|tornado|ice\\.storm|winter\\.weather|strong\\.wind|hail|heat\\.wave|avalanche|Landslide|lightning|income")) |>
  select(where(is.numeric))
output_environmentalRisk[is.na(output_environmentalRisk)] <- 0
subset_df <- output_environmentalRisk[, grep("income|sales|farm_sales", names(output_environmentalRisk), ignore.case = TRUE), drop = FALSE]


risk_types <- c("drought", "wildfire", "Cold\\.Wave", "tornado",
                "ice\\.storm", "winter\\.weather", "strong\\.wind", "hail",
                "heat\\.wave", "avalanche", "Landslide", "lightning")

risk_dfs <- list()

for (risk in risk_types) {
  clean_risk_name <- gsub("\\\\", "", risk)

  risk_dfs[[clean_risk_name]] <- output_environmentalRisk[, grepl(risk, names(output_environmentalRisk), ignore.case = TRUE)] |> cbind(subset_df)
}

for (i in names(risk_dfs)) {
  assign(i, risk_dfs[[i]])
}

source("C:/Users/natha/OneDrive/Documents/internship/workspace/Analysis/create_correlogram_function.R")

N <- c("drought", "wildfire", "Cold.Wave", "tornado", "ice.storm", "winter.weather", "strong.wind", "hail", "heat.wave", "avalanche", "Landslide", "lightning")
generate_corr_plot(N)

print(drought_corrplot)
print(wildfire_corrplot)
print(winter.weather_corrplot)
print(hail_corrplot)
print(ice.storm_corrplot)
print(Cold.Wave_corrplot)
print(heat.wave_corrplot)
print(strong.wind_corrplot)
print(tornado_corrplot)
print(lightning_corrplot)
print(avalanche_corrplot)
```

